<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>TRPG Chat API í…ŒìŠ¤íŠ¸</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { margin: 5px; padding: 8px 12px; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>TRPG Chat API í…ŒìŠ¤íŠ¸</h1>
  <button id="healthBtn">ğŸ’“ Health ì²´í¬</button>
  <button id="signupBtn">ğŸ“ íšŒì›ê°€ì…</button>
  <button id="loginBtn">ğŸ”‘ ë¡œê·¸ì¸</button>
  <button id="validateBtn">âœ… í† í° ê²€ì¦</button>
  <button id="chatBtn">ğŸ’¬ ì±„íŒ… ë¡œê·¸</button>
  <button id="runAllBtn">ğŸš€ ì „ì²´ ìë™ ì‹¤í–‰</button>
  <pre id="output"></pre>

  <script>
    const output = document.getElementById("output");
    let accessToken = "";

    function log(message) {
      output.textContent += message + "\n";
    }

    // ê³µí†µ fetch í•¨ìˆ˜
    async function callAPI(url, options = {}, label = "") {
      try {
        const res = await fetch(url, options);
        const data = await res.json();
        log(`${label}: ${JSON.stringify(data)}`);
        return data;
      } catch (err) {
        log(`${label} ì˜¤ë¥˜: ${err.message}`);
      }
    }

    // ê°œë³„ ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById("healthBtn").addEventListener("click", () =>
      callAPI("http://localhost:3000/health", {}, "Health")
    );

    document.getElementById("signupBtn").addEventListener("click", () =>
      callAPI("http://localhost:3000/users", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name: "Alice", nickname: "alice", email: "alice@example.com", password: "1234" })
      }, "Signup")
    );

    document.getElementById("loginBtn").addEventListener("click", async () => {
      const data = await callAPI("http://localhost:3000/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: "alice@example.com", password: "1234" })
      }, "Login");
      if (data?.access_token) {
        accessToken = data.access_token;
        log("ğŸ‘‰ Access Token ì €ì¥ë¨");
      }
    });

    document.getElementById("validateBtn").addEventListener("click", () =>
      callAPI("http://localhost:3000/auth/validate-token", {
        headers: { "Authorization": "Bearer " + accessToken }
      }, "Validate Token")
    );

    document.getElementById("chatBtn").addEventListener("click", () =>
      callAPI("http://localhost:3000/chat/logs?roomId=1", {}, "Chat Logs")
    );

    // ì „ì²´ ì‹¤í–‰
    document.getElementById("runAllBtn").addEventListener("click", async () => {
      output.textContent = "";
      log("=== ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===");

      await callAPI("http://localhost:3000/health", {}, "1. Health");
      await callAPI("http://localhost:3000/users", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name: "Alice", nickname: "alice", email: "alice@example.com", password: "1234" })
      }, "2. Signup");

      const login = await callAPI("http://localhost:3000/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: "alice@example.com", password: "1234" })
      }, "3. Login");
      if (login?.access_token) {
        accessToken = login.access_token;
        log("ğŸ‘‰ Access Token ì €ì¥ë¨");
      }

      await callAPI("http://localhost:3000/auth/validate-token", {
        headers: { "Authorization": "Bearer " + accessToken }
      }, "4. Validate Token");

      await callAPI("http://localhost:3000/chat/logs?roomId=1", {}, "5. Chat Logs");

      log("=== í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===");
    });
  </script>
</body>
</html>
